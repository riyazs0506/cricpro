{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <div class="card shadow-sm p-4">

    <h4 class="fw-bold mb-3">ðŸ’° Match Fee Payment</h4>

    <p><b>Match:</b> {{ availability.title }}</p>
    <p><b>Date:</b> {{ availability.match_date }}</p>
    <p><b>Venue:</b> {{ availability.venue }}</p>

    <hr>

    <h5 class="text-success mb-3">
      Amount to Pay: â‚¹{{ availability.amount }}
    </h5>

    <button id="pay-btn" class="btn btn-primary w-100 mb-3">
      ðŸ’³ Pay Online (UPI / QR / Card)
    </button>

    <a href="{{ url_for('payments.cash_payment', availability_id=availability.id) }}"
       class="btn btn-warning w-100">
      ðŸ’µ Cash (Coach Approval Required)
    </a>

  </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
document.getElementById("pay-btn").onclick = function () {

  fetch("{{ url_for('payments.create_payment_order', availability_id=availability.id) }}")
    .then(res => res.json())
    .then(data => {

      if (!data.order_id) {
        alert("Payment service error. Please try again.");
        return;
      }

      var options = {
        key: data.key,
        amount: data.amount,
        currency: "INR",
        name: "CricPro",
        description: "Match Fee",
        order_id: data.order_id,

        method: {
          upi: true,
          card: true,
          netbanking: true,
          wallet: true
        },

        handler: function (response) {
          var form = document.createElement("form");
          form.method = "POST";
          form.action = "{{ url_for('payments.payment_success') }}";

          ["razorpay_payment_id",
           "razorpay_order_id",
           "razorpay_signature"].forEach(function (k) {
            var i = document.createElement("input");
            i.type = "hidden";
            i.name = k;
            i.value = response[k];
            form.appendChild(i);
          });

          document.body.appendChild(form);
          form.submit();
        }
      };

      var rzp = new Razorpay(options);
      rzp.open();
    });
};
</script>

{% endblock %}